[package]
name = "vecboost"
version = "0.1.0"
edition = "2024"
authors = ["Architecture Team"]

[dependencies]
# Web Framework
axum = "0.7"
axum-extra = { version = "0.9", features = ["typed-header"] }
tokio = { version = "1.35", features = ["full"] }
tower-http = { version = "0.5", features = ["trace", "cors", "add-extension", "validate-request", "set-header"] }

# gRPC support
tonic = "0.12"
prost = "0.13"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# Configuration
config = "0.14"
toml = "0.8"

# Logging & Tracing
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# Error Handling
thiserror = "1.0"
anyhow = "1.0"
async-trait = "0.1"

# AI & Math
candle-core = { version = "0.9.2-alpha.2", features = [] }
candle-nn = "0.9.2-alpha.2"
candle-transformers = "0.9.2-alpha.2"
hf-hub = "0.3"

# Utilities
ndarray = { version = "0.16", optional = true }
ort = { version = "2.0.0-rc.10", optional = true }

# Utilities
uuid = { version = "1.7", features = ["v4"] }
clap = { version = "4.4", features = ["derive"] }
tempfile = "3.12"
futures = "0.3"
sys-info = "0.9"
num_cpus = "1.16"
lru = "0.12"
hashbrown = "0.14"
xxhash-rust = { version = "0.8", features = ["xxh3"] }
chrono = { version = "0.4", features = ["serde"] }
regex = "1.10"
home = "0.5"
reqwest = { version = "0.12", features = ["stream"] }
sha2 = "0.10"
jsonwebtoken = "9.3"
password-hash = { version = "0.5", features = ["rand_core"] }
argon2 = "0.5"
rand = "0.8"
aes-gcm = "0.10"
hex = "0.4"

# CUDA support - only available on Linux with CUDA toolkit
cudarc = { version = "0.18.2", optional = true, default-features = false }

[build-dependencies]
tonic-build = "0.12"

[features]
default = []
cuda = ["candle-core/cuda", "candle-nn/cuda"]
onnx = ["ndarray", "ort"]
metal = ["candle-core/metal", "candle-nn/metal"]
grpc = []

# Platform-specific default features
# macOS defaults to metal support
[target.'cfg(target_os = "macos")'.dependencies]
tokenizers = { version = "0.15", features = ["http"] }

# Linux defaults to CUDA support
[target.'cfg(target_os = "linux")'.dependencies]
# Default to CUDA feature on Linux

# Windows defaults to CUDA support
[target.'cfg(target_os = "windows")'.dependencies]
# Default to CUDA feature on Windows

[profile.dev]
opt-level = 1

[[example]]
name = "gpu_basic_device_test"
path = "examples/gpu/basic_device_test.rs"
required-features = ["cuda"]

[[example]]
name = "gpu_candle_engine_test"
path = "examples/gpu/candle_engine_test.rs"
required-features = ["cuda"]

[[example]]
name = "gpu_onnx_engine_test"
path = "examples/gpu/onnx_engine_test.rs"
required-features = ["cuda", "onnx"]

[[example]]
name = "gpu_performance_comparison"
path = "examples/gpu/performance_comparison.rs"
required-features = ["cuda", "onnx"]